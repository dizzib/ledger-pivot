// 1.1.0
(function(){var t,e=function(t,e){function r(){this.constructor=t}for(var a in e)n.call(e,a)&&(t[a]=e[a]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;(t=function(t){return"object"==typeof exports&&"object"==typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){var r,a;return r=function(t){function n(t,e){n.__super__.constructor.call(this,t,e)}var r;return e(n,t),r=function(t,e,n,r,a){var l,o,i,s,h,u,d;for(h=[],l=!1,s=0,u=r.length;s<u;s++)o=r[s],h.push(null!=(d=t[o])?d:"null"),i=h.join(String.fromCharCode(0)),e[i]||(e[i]=a(h.slice()),l=!0),e[i].push(t);return l&&n.push(h),h},n.prototype.processRecord=function(t){var e,n,a,l,o,i,s,h,u,d,c,p,f;if(f=[],e=[],this.allTotal.push(t),f=r(t,this.rowTotals,this.rowKeys,this.rowAttrs,function(t){return function(e){return t.aggregator(t,e,[])}}(this)),e=r(t,this.colTotals,this.colKeys,this.colAttrs,function(t){return function(e){return t.aggregator(t,[],e)}}(this)),u=f.length-1,d=e.length-1,!(u<0||d<0)){for(p=[],i=h=0,c=u;0<=c?h<=c:h>=c;i=0<=c?++h:--h)a=f.slice(0,i+1),o=a.join(String.fromCharCode(0)),this.tree[o]||(this.tree[o]={}),p.push(function(){var r,i,h;for(h=[],s=r=0,i=d;0<=i?r<=i:r>=i;s=0<=i?++r:--r)n=e.slice(0,s+1),l=n.join(String.fromCharCode(0)),this.tree[o][l]||(this.tree[o][l]=this.aggregator(this,a,n)),h.push(this.tree[o][l].push(t));return h}.call(this));return p}},n}(t.pivotUtilities.PivotData),t.pivotUtilities.SubtotalPivotData=r,a=function(e,r){var a,l,o,i,s,h,u,d,c,p,f,g,v,b,w,C,m,y,A,S,x,T,k,K,E,L,_,j,H,R;return S={localeStrings:{totals:"Totals"}},r=t.extend(S,r),l="▶",o="◢",b=e.colAttrs,E=e.rowAttrs,L=e.getRowKeys(),w=e.getColKeys(),R=e.tree,_=e.rowTotals,C=e.colTotals,a=e.allTotal,A=function(t,e,r,a){var l,o,i;if(o=document.createElement(t),e&&(o.className=e),null!==r&&void 0!==r&&(o.textContent=r),a)for(l in a)n.call(a,l)&&(i=a[l],o.setAttribute(l,i));return o},K=function(t,e){var n,r,a,l,o,i,s,h,u,d,c,p,f;for(i=t.length-1,o=t[0].length-1,d=[],l=[],p=A("th",e,t[0][0]),r=t[0][0],h=0,s={node:h,row:0,col:0,th:p,parent:null,children:[],descendants:o,leaves:1,flatKey:r},l[0]=s,d[0]=s,n=1;n<=o;)p=A("th",e,t[0][n]),r=r+String.fromCharCode(0)+t[0][n],++h,s={node:h,row:0,col:n,th:p,parent:d[n-1],children:[],descendants:o-n,leaves:1,flatKey:r},d[n]=s,d[n-1].children.push(s),++n;for(d[o].leaves=0,u=1;u<=i;){for(c=!0,r="",n=0;n<=o;)if(r=0===n?t[u][n]:r+String.fromCharCode(0)+t[u][n],t[u][n]===t[d[n].row][n]&&n!==o&&c)c=!0,++n;else{if(p=A("th",e,t[u][n]),++h,a={node:h,row:u,col:n,th:p,parent:null,children:[],descendants:0,leaves:1,flatKey:r},0===n)l.push(a);else for(a.parent=d[n-1],d[n-1].children.push(a),f=0;f<=n-1;)d[f].descendants=d[f].descendants+1,++f;d[n]=a,c=!1,++n}for(n=0;n<=o;)d[n].leaves=d[n].leaves+1,++n;d[o].leaves=0,++u}return l},i=function(t,e,n){var r,a,l,o,i,s;for(s=document.createElement("tr"),0!==n.length&&s.appendChild(A("th",null,null,{colspan:n.length,rowspan:b.length})),s.appendChild(A("th","pvtAxisLabel",b[0])),e[0]=s,t.appendChild(s),o=[],r=a=1,l=b.length;1<=l?a<=l:a>=l;r=1<=l?++a:--a)r<b.length&&(s=document.createElement("tr"),i=A("th","pvtAxisLabel",b[r]),s.appendChild(i),e[r]=s,t.appendChild(s),o.push(++r));return o},s=function(t,e,n,r,a,l){var o,i,h,u,d,c,p;for(u=n.children,i=0,h=u.length;i<h;i++)o=u[i],s(t,e,o,n,a,l);return p=t[n.col],c=n.th,n.col===a.length-1&&0!==l.length&&c.setAttribute("rowspan",2),0!==n.children.length&&c.setAttribute("colspan",n.descendants),p.appendChild(c),0!==n.children.length&&(d=a.length-n.col+(0!==l.length?1:0),c=A("th","pvtColLabel","",{rowspan:d}),p.appendChild(c)),n.tr=p,e.push(n)},c=function(t,e,n,r){var a,l,i,s,h;h=document.createElement("tr"),e.th=[];for(a in n)l=n[a],i=l,a<n.length-1&&(i=" "+o+" "+l),s=A("th","pvtAxisLabel",i),s.setAttribute("data-rowAttr",l),h.appendChild(s),e.th.push({th:s,clickStatus:"expanded"});return 0!==r.length&&(s=A("th"),h.appendChild(s)),t.appendChild(h),e.tr=h},p=function(t,e,n){var r,a,l,o,i,s;for(o=[],r=a=0,l=n.length-1;0<=l?a<=l:a>=l;r=0<=l?++a:--a)r<n.length-1&&(s=t.th[r],i=n[r],o.push(s.th.onclick=function(r){return r=r||window.event,H(t,e,n,r.target.getAttribute("data-rowAttr"))}));return o},g=function(t,e,n){var a,l;return a=1,0!==e.length&&(a=e.length+(0===n.length?0:1)),l=A("th","pvtTotalLabel",r.localeStrings.totals,{rowspan:a}),t.appendChild(l)},f=function(t,e,n,r,a){var l,i,s,h,u,d,c,p;for(p=document.createElement("tr"),c=n.th,c.setAttribute("rowspan",n.descendants+1),c.setAttribute("data-rowHeader",c.textContent),n.col===r.length-1&&0!==a.length&&c.setAttribute("colspan",2),c.setAttribute("data-node",e.length),p.appendChild(c),0!==n.children.length&&(c.textContent=" "+o+" "+c.textContent,c.onclick=function(t){return t=t||window.event,j(e,parseInt(t.target.getAttribute("data-node")))},l=r.length-(n.col+1)+(0!==a.length?1:0),c=A("th","pvtRowLabel","",{colspan:l}),p.appendChild(c)),n.clickStatus="expanded",n.tr=p,e.push(n),t.appendChild(p),u=n.children,d=[],s=0,h=u.length;s<h;s++)i=u[s],d.push(f(t,e,i,r,a));return d},v=function(t,e){var n,r,a,l,o,i,s,h,u,d,c,p,f,g,v,b;for(d=[],o=0,s=t.length;o<s;o++){for(c=t[o],v=c.tr,l=c.flatKey,i=0,h=e.length;i<h;i++)r=e[i],a=r.flatKey,n=null!=(u=R[l][a])?u:{value:function(){return null},format:function(){return""}},b=n.value(),p="pvtVal",p=0!==r.children.length?p+" pvtSubtotal":p,p=p+" row"+c.row+" col"+r.col,f=A("td",p,n.format(b),{"data-value":b}),v.appendChild(f);g=_[l],b=g.value(),f=A("td","pvtTotal rowTotal",g.format(b),{"data-value":b,"data-row":"row"+c.row,"data-col":"col"+c.col}),d.push(v.appendChild(f))}return d},u=function(t,e){var n,a,l;return l=document.createElement("tr"),n=t.length+(0===e.length?0:1),a=A("th","pvtTotalLabel",r.localeStrings.totals,{colspan:n}),l.appendChild(a),l},h=function(t,e){var n,r,a,l,o,i,s;for(l=[],r=0,a=e.length;r<a;r++)n=e[r],i=C[n.flatKey],s=i.value(),o=A("td","pvtTotal colTotal",i.format(s),{"data-value":s,"data-for":"col"+n.col}),l.push(t.appendChild(o));return l},d=function(t,e){var n,r,l;return r=a,l=r.value(),n=A("td","pvtGrandTotal",r.format(l),{"data-value":l}),e.appendChild(n),t.appendChild(e)},m=function(t,e){var n,r,a,o,i,s,h;if(t[e]){for(r=t[e],h=0,a=o=1,s=r.descendants;1<=s?o<=s:o>=s;a=1<=s?++o:--o)0!==r.descendants&&(n=t[e+a],0!==n.descendants&&(n.th.textContent=" "+l+" "+n.th.getAttribute("data-rowHeader")),n.clickStatus="collapsed",n.th.setAttribute("rowspan",1),"none"!==n.tr.style.display&&(++h,n.tr.style.display="none"));for(i=r.parent;null!==i;)i.th.setAttribute("rowspan",parseInt(i.th.getAttribute("rowspan"))-h),i=i.parent;return 0!==r.descendants&&(r.th.textContent=" "+l+" "+r.th.getAttribute("data-rowHeader")),r.clickStatus="collapsed",r.th.setAttribute("rowspan",1),r.tr.style.display=""}},x=function(t,e){var n,r,a,i,s,h,u,d,c,p,f,g;if(t[e]){for(g=0,a=t[e],i=s=1,c=a.descendants;1<=c?s<=c:s>=c;i=1<=c?++s:--s)0!==a.descendants&&(r=t[e+i],0!==r.descendants&&(r.th.textContent=" "+l+" "+r.th.getAttribute("data-rowHeader")),r.clickStatus="collapsed",r.th.setAttribute("rowspan",1),"none"!==r.tr.style.display&&(--g,r.tr.style.display="none"));for(p=a.children,h=0,u=p.length;h<u;h++)n=p[h],"none"===n.tr.style.display&&(++g,n.tr.style.display="");for(a.th.setAttribute("rowspan",a.children.length+1),0!==a.descendants&&(a.th.textContent=" "+o+" "+a.th.getAttribute("data-rowHeader")),a.clickStatus="expanded",a.tr.style.display="",d=a.parent,f=[];null!==d;)d.th.setAttribute("rowspan",g+parseInt(d.th.getAttribute("rowspan"))),f.push(d=d.parent);return f}},j=function(t,e){if(t[e])return"collapsed"===t[e].clickStatus?x(t,e):m(t,e)},y=function(t,e,n,r){var a,o,i,s,h,u,d;if(i=n.indexOf(r),!(i<0||i===n.length-1)){for(o=i,s=n.length-1;o<s;)d=t.th[o],d.th.textContent=" "+l+" "+n[o],d.clickStatus="collapsed",++o;for(o=0,h=e.length,u=[];o<h;)a=e[o],a.col===i?(m(e,a.node),u.push(o=o+a.descendants+1)):u.push(++o);return u}},T=function(t,e,n,r){var a,l,i,s,h,u,d,c,p;if(i=n.indexOf(r),!(i<0||i===n.length-1)){for(c=[],l=h=0,d=i;0<=d?h<=d:h>=d;l=0<=d?++h:--h)p=t.th[l],p.th.textContent=" "+o+" "+n[l],p.clickStatus="expanded",s=0,u=e.length,c.push(function(){var t;for(t=[];s<u;)a=e[s],a.col===l?(x(e,a.node),t.push(s=s+a.descendants+1)):t.push(++s);return t}());return c}},H=function(t,e,n,r){var a,l;return a=n.indexOf(r),l=t.th[a],"collapsed"===l.clickStatus?T(t,e,n,r):y(t,e,n,r)},(k=function(t,e,n,a){var l,o,b,w,C,m,A,S,x,T,k,E,L,_,j,H;if(E=[],b=[],T={},k=[],o=[],l=[],0!==t.length&&(E=K(e,"pvtRowLabel")),0!==n.length&&(L=Date.now(),b=K(a,"pvtColLabel")),x=document.createElement("table"),x.className="pvtTable",j=document.createElement("thead"),x.appendChild(j),0!==n.length)for(i(j,o,t),C=0,A=b.length;C<A;C++)w=b[C],s(o,l,w,null,n,t);if(0!==t.length&&(c(j,T,t,n),0===n.length&&g(T.tr,n,t)),0!==n.length&&(L=Date.now(),g(o[0],n,t)),_=document.createElement("tbody"),x.appendChild(_),0!==t.length){for(m=0,S=E.length;m<S;m++)w=E[m],f(_,k,w,t,n);p(T,k,t)}return v(k,l),H=u(t,n),0!==n.length&&h(H,l),d(_,H),x.setAttribute("data-numrows",e.length),x.setAttribute("data-numcols",a.length),r.collapseRowsAt&&y(T,k,t,r.collapseRowsAt),x})(E,L,b,w)},t.pivotUtilities.subtotal_renderers={"Table With Subtotal":function(t,e){return a(t,e)},"Table With Subtotal Bar Chart":function(e,n){return t(a(e,n)).barchart()},"Table With Subtotal Heatmap":function(e,n){return t(a(e,n)).heatmap()},"Table With Subtotal Row Heatmap":function(e,n){return t(a(e,n)).heatmap("rowheatmap")},"Table With Subtotal Col Heatmap":function(e,n){return t(a(e,n)).heatmap("colheatmap")}}})}).call(this);
//# sourceMappingURL=subtotal.min.js.map
